import{t as m,c as Z,a as v,b as ve}from"../chunks/Ba07GB51.js";import{B as ie,i as me,l as t,n as fe,g as qe,u as ge,A as c,z as X,y as D,D as _,G as d,H as V,x as b,I as B,C as ne}from"../chunks/DcSgunAn.js";import{d as le,s as W}from"../chunks/BK38orX7.js";import{e as ue,i as ce,s as Re}from"../chunks/Dxk-5unR.js";import{b as he,p as F,a as y,s as Oe,c as Se}from"../chunks/D_PpuvHk.js";import{g as u,d as N,t as de,a as xe,r as Ae,f as Pe,e as $e,w as ye,P as ze}from"../chunks/Bk3tDF3f.js";import{s as re}from"../chunks/Cho7X1U_.js";import{p as Te}from"../chunks/xJOvmrBY.js";import{a as Xe}from"../chunks/Bycu4k-w.js";import{r as Ce,a as Me}from"../chunks/DUR6UqLw.js";import{i as je,s as De}from"../chunks/B7C0I3Mn.js";import{a as pe}from"../chunks/Ci0KcNdQ.js";import{g as Be}from"../chunks/ylLvelAk.js";import{T as _e}from"../chunks/BXAdBgQj.js";var Ee=m('<div class="field svelte-1e91go2" role="button"></div>'),Ue=m('<div class="field X svelte-1e91go2"></div>'),Le=m('<div class="field O svelte-1e91go2"></div>'),Ge=m('<div class="row svelte-1e91go2"></div>'),Ke=m('<h2 class="toast">Hráč <span> </span> vyhrál!</h2>'),We=m('<h2 class="toast">Dorazila vyřešená úloha, hráč <span> </span> vyhrál!</h2>'),He=m('<h2><span> </span> na tahu</h2> <div class="grid svelte-1e91go2"></div> <!>',1);function Ne(S,h){ie(h,!0);let f=he(h,"boardApiInfo",7),C=fe(()=>f().name);me(()=>{document.title="Hra - "+t(C)});function x(e,a){let i=0;for(let s of e)for(let p of s)a==p&&i++;return i}let q="",r=X("X"),R=X(!1),k=X(""),P=X(!1),A=fe(()=>f().uuid);qe(()=>{console.log("board state reset due uuid changing",t(A)),ge(()=>{q="",c(r,"X"),c(R,!1),c(k,""),c(P,!1),O(),M()})});function O(){console.log("co bylo v effectu runuje");let e=x(f().board,"X"),a=x(f().board,"O");(e+a)%2==0?(q="O",c(r,"X")):(q="X",c(r,"O"))}function M(){for(let e=0;e<15;e++)for(let a=0;a<15;a++){let i=f().board[e][a];if((i=="X"||i=="O")&&$(e,a,i)){c(P,!0),c(R,!0);return}}}function $(e,a,i){let s={n:0,ne:0,e:0,se:0,s:0,sw:0,w:0,nw:0},p=new Set(["n","ne","e","se","s","sw","w","nw"]);for(let l=1;l<=4;l++){let H={n:[e-l,a,"n"],ne:[e-l,a+l,"ne"],e:[e,a+l,"e"],se:[e+l,a+l,"se"],s:[e+l,a,"s"],sw:[e+l,a-l,"sw"],w:[e,a-l,"w"],nw:[e-l,a-l,"nw"]},o=[...p.keys()].map(n=>{let[T,G,se]=H[n];if(0<=T&&T<15&&0<=G&&G<15)return[f().board[T][G],se]}).filter(n=>{if(n==null)return!1;let[T,G]=n;if(T==i)return!0}).map(n=>n[1]);p=new Set(o),o.forEach(n=>{s[n]++})}let w=[s.s+s.n,s.ne+s.sw,s.e+s.w,s.se+s.nw].some(l=>l>=4);return w&&c(k,F(i)),w}function j(e,a){if(!t(R)){if(f().board[e][a]=t(r),q=t(r),$(e,a,t(r))){console.log(`${t(r)} wins!`),c(R,!0);return}q==="X"?c(r,"O"):c(r,"X"),console.log("handleMove",t(r))}}var E=He(),z=D(E),U=_(z),I=_(U,!0);d(U),V(),d(z);var L=b(z,2);ue(L,21,()=>f().board,ce,(e,a,i)=>{var s=Ge();ue(s,21,()=>t(a),ce,(p,g,w)=>{var l=Z(),H=D(l);{var J=o=>{var n=Ee();n.__click=()=>j(i,w),v(o,n)},Y=o=>{var n=Z(),T=D(n);{var G=K=>{var Q=Ue();v(K,Q)},se=K=>{var Q=Z(),be=D(Q);{var ke=oe=>{var we=Le();v(oe,we)};y(be,oe=>{t(g)=="O"&&oe(ke)},!0)}v(K,Q)};y(T,K=>{t(g)=="X"?K(G):K(se,!1)},!0)}v(o,n)};y(H,o=>{t(g)==""?o(J):o(Y,!1)})}v(p,l)}),d(s),v(e,s)}),d(L);var ee=b(L,2);{var ae=e=>{var a=Ke(),i=b(_(a)),s=_(i,!0);d(i),V(),d(a),B(()=>{re(i,`player ${t(r)??""} svelte-1e91go2`),W(s,t(r))}),v(e,a)},te=e=>{var a=Z(),i=D(a);{var s=p=>{var g=We(),w=b(_(g)),l=_(w,!0);d(w),V(),d(g),B(()=>{re(w,`player ${t(k)??""} svelte-1e91go2`),W(l,t(k))}),v(p,g)};y(i,p=>{t(R)&&t(P)&&p(s)},!0)}v(e,a)};y(ee,e=>{t(R)&&!t(P)?e(ae):e(te,!1)})}B(()=>{re(U,`player ${t(r)??""} svelte-1e91go2`),W(I,t(r))}),v(S,E),ne()}le(["click"]);var Ze=(S,h,f)=>{S.key=="Enter"?h():S.key=="Escape"&&f()},Ve=m('<div class="popup-container svelte-1f2y6qx"><div class="popup svelte-1f2y6qx"><div class="title svelte-1f2y6qx"><h2 class="svelte-1f2y6qx">Uložit jako</h2> <div class="contentBar svelte-1f2y6qx"><input type="text" class="svelte-1f2y6qx"> <select class="svelte-1f2y6qx"><option class="o svelte-1f2y6qx">začátečník</option><option class="o svelte-1f2y6qx">jednoduchá</option><option class="o svelte-1f2y6qx">pokročilá</option><option class="o svelte-1f2y6qx">těžká</option><option class="o svelte-1f2y6qx">nejtěžší</option></select></div></div> <div><button class="ok">OK</button> <button>Zrušit</button></div></div></div>');function Je(S,h){ie(h,!0);let f=he(h,"dialogState",15);function C(z){z.select()}async function x(){u.apiResponse.name=document.querySelector("input").value,u.apiResponse.difficulty=xe[document.querySelector("select").value],q(),await f().OKCallback()}function q(){f(f().show=!1,!0)}var r=Ve(),R=_(r),k=_(R),P=b(_(k),2),A=_(P);Ce(A),A.__keydown=[Ze,x,q],Xe(A,z=>C==null?void 0:C(z));var O=b(A,2);je(O,()=>N[u.apiResponse.difficulty]);var M;d(P),d(k);var $=b(k,2),j=_($);j.__click=x;var E=b(j,2);E.__click=q,d($),d(R),d(r),B(()=>{Me(A,u.apiResponse.name),M!==(M=N[u.apiResponse.difficulty])&&(O.value=(O.__value=N[u.apiResponse.difficulty])==null?"":N[u.apiResponse.difficulty],De(O,N[u.apiResponse.difficulty]))}),de(1,r,()=>pe,()=>({duration:75})),de(2,r,()=>pe,()=>({duration:95})),v(S,r),ne()}le(["keydown","click"]);async function Ye(S,h,f){(await $e(h().params.uuid)).ok&&(c(f,!0),await ye(2e3),c(f,!1))}var Qe=m("<h1> </h1>"),Fe=m("<h1>Piškvorky</h1>"),Ie=m("<button>Uložit změny</button>"),ea=(S,h,f)=>h(f),aa=m("<button>Uložit jako úlohu</button>"),ta=m("<div><!> <!></div> <!>",1),sa=m('<h2 class="errorMessage svelte-1t7nq9e"> </h2>'),oa=m('<div class="center"><!> <!> <!> <!></div>');function ya(S,h){ie(h,!0);const[f,C]=Oe(),x=()=>Se(Te,"$page",f),q=ze;let r=X(F({show:!1,OKCallback:void 0}));function R(e){t(r).show=!0,t(r).OKCallback=e}let k=X(!1);async function P(){if(x().params.uuid)throw new Error("You're editing an existing game, use editPuzzle instead");{const e=await fetch(`${q}/games`,{method:"POST",body:JSON.stringify({name:u.apiResponse.name,board:u.apiResponse.board,difficulty:u.apiResponse.difficulty}),headers:{"Content-Type":"application/json"}}),a=await e.json();console.log("data",a),e.ok?(Be(`/game/${a.uuid}`),c(k,!0),await ye(2e3),c(k,!1)):e.status==422&&alert("Stav křižků neodpovídá stavu koleček nebo naopak")}}let A=X(!1),O=X(!1),M=X("");me(()=>{const e=x().params.uuid;console.log("slug changed to",e),e?ge(()=>{if(console.log("gameInfo is",Re(u)),"apiResponse"in u&&u.apiResponse.uuid==e){c(O,!0);return}Pe(e).then(a=>{console.log("game fetched fresh from server"),u.apiResponse=a,u.selected=!0,c(O,!0)}).catch(a=>{c(M,F(a))})}):(console.log("reset to empty board when no uuid in url"),Ae(),c(O,!0))});var $=oa(),j=_($);{var E=e=>{var a=ta(),i=D(a),s=_(i);{var p=o=>{var n=Qe(),T=_(n,!0);d(n),B(()=>W(T,u.apiResponse.name)),v(o,n)},g=o=>{var n=Fe();v(o,n)};y(s,o=>{u.apiResponse.name?o(p):o(g,!1)})}var w=b(s,2);{var l=o=>{var n=Ie();n.__click=[Ye,x,A],v(o,n)},H=o=>{var n=aa();n.__click=[ea,R,P],v(o,n)};y(w,o=>{x().params.uuid?o(l):o(H,!1)})}d(i);var J=b(i,2);{var Y=o=>{Ne(o,{get boardApiInfo(){return u.apiResponse}})};y(J,o=>{u.selected&&o(Y)})}v(e,a)},z=e=>{var a=Z(),i=D(a);{var s=p=>{var g=sa(),w=_(g,!0);d(g),B(()=>W(w,t(M))),v(p,g)};y(i,p=>{t(M)&&p(s)},!0)}v(e,a)};y(j,e=>{t(O)?e(E):e(z,!1)})}var U=b(j,2);{var I=e=>{Je(e,{get dialogState(){return t(r)},set dialogState(a){c(r,F(a))}})};y(U,e=>{t(r).show&&e(I)})}var L=b(U,2);{var ee=e=>{_e(e,{children:(a,i)=>{V();var s=ve();B(()=>W(s,`Úloha ${u.apiResponse.name??""} uložena`)),v(a,s)},$$slots:{default:!0}})};y(L,e=>{t(k)&&e(ee)})}var ae=b(L,2);{var te=e=>{_e(e,{children:(a,i)=>{V();var s=ve("Změny uloženy");v(a,s)},$$slots:{default:!0}})};y(ae,e=>{t(A)&&e(te)})}d($),v(S,$),ne(),C()}le(["click"]);export{ya as component};
